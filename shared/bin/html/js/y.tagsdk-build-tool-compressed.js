(function(){Function.prototype.bind=Function.prototype.bind||function(A){var B=this;return function(){return B.apply(A,arguments)}}}());var global=this;try{global=(false||eval)("this")||(function(){return this}())||window}catch(e){}global.VERSION="1.0.2-b1";var EMPTY_FUN=function(){};var UNDEF=undefined;global.APP_PATH=global.APP_PATH||"/";global.LIBRARIES_REPO_LOC=global.LIBRARIES_REPO_LOC||"/";function fitTextarea(A){if(A.tagName.toLowerCase()==="textarea"){A.style.overflow="hidden";A.style.height="0px";A.scrollHeight;A.style.height=(25+A.scrollHeight)+"px";A.style.overflow=""}}function nextNode(A){while(!A.tagName){A=A.nextSibling}return A}function toggleShowSibling(F,B){var C=B||F.nextSibling;while(C&&!C.style){C=C.nextSibling}if(C){var E=false;var A=C.cmNode&&C.cmNode.style.display==="none";if(A){C.cmNode.style.display="";E=true}else{if(!C.cmNode&&C.style.display==="none"){C.style.display="";E=true;if(C.tagName==="TEXTAREA"){attachEditor(C)}fitTextarea(C)}else{C.style.display="none";if(C.cmNode){C.cmNode.style.display="none"}}}var D=F.children[0];if(D&&D.getAttribute("plus")==="true"){if(E){D.innerHTML="-"}else{D.innerHTML="+"}}}}function attachEditor(A){A.cm=CodeMirror.fromTextArea(A,{lineNumbers:true,mode:"javascript",theme:"ambiance",tabMode:"indent",matchBrackets:true,extraKeys:{"Ctrl-Q":function(B){B.foldCode(B.getCursor())}},foldGutter:true,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"]});A.cm.on("change",function(){A.value=A.cm.getValue()});A.cmNode=A.nextSibling}function getParametersAndConfigForTagNode(K,I,A){var G=K.getElementsByTagName("input");var F=K.reference;var B=F.config;for(var D=0;D<G.length;D++){if(!I){if(G[D].className.indexOf("red")!==-1){return"red"}}if(G[D].pindex!==undefined){var J=G[D].pindex;B.parameters[J].inputVariable=G[D].value;B.parameters[J].variable=undefined;if(G[D].value){try{var C=qubit.opentag.Utils.gevalAndReturn(G[D].value);C=C?C.result:C;B.parameters[J].variable={value:C}}catch(H){logError("Error reading configuration"+H)}}}else{if(!A&&G[D].cname!==undefined){var E=G[D].cname;switch(E){case"url":case"html":case"urlLocation":case"vendor":case"imageUrl":case"url":B[E]=G[D].value;break;default:try{B[E]=qubit.opentag.Utils.gevalAndReturn(G[D].value).result}catch(H){}}}}}if(A){return{parameters:B.parameters}}return B}function applyParametersAndConfigToTag(A,B){A.parameters=B.parameters;for(var C in B){A[C]=B[C]}}function classPath(C){if(C){var E=C.split(".");for(var D=0;D<E.length;D++){var B=E[D];B=B.replace(/\s+/g,"_");B=B.replace(/[\W+]/g,"");if(B.match(/^\d+/)){B="_"+B}E[D]=B}var A=E.join(".");return A.replace(/^[\.]+/g,"").replace(/[\.]+$/g,"").replace(/\.+/g,".")}else{return C}}function getLibraryReferenceNode(A){while(A!==null&&!A.reference){A=A.parentNode}return A}window.__tmp__qubit__test_page_8_=null;function extractFunctionOrString(B){var A=qubit.opentag.Utils.trim(B);if(A.indexOf("function")===0){qubit.opentag.Utils.geval("window.__tmp__qubit__test_page_8_="+A);return window.__tmp__qubit__test_page_8_}else{return B}}var IS_IE=false;if(navigator.appName.indexOf("Internet Explorer")!==-1){IS_IE=true}function getXMLHttpRequest(){var B;try{B=new ActiveXObject("Microsoft.XMLHTTP")}catch(C){try{B=new ActiveXObject("Msxml2.XMLHTTP")}catch(C){try{B=new XMLHttpRequest()}catch(C){throw"Your browser does not support AJAX!"}}}if(!IS_IE){B.onerror=function A(){}}else{window.onerror=function A(){}}return B}function GET(A,F,D){var C=getXMLHttpRequest();C.onreadystatechange=function(){if(C.readyState===4){F(C.responseText,C)}};D=(D===undefined)?true:D;try{C.onerror=function(G){logError("Error while sending GET:"+G)}}catch(B){}var E=fakeParam(A);C.open("GET",E,D);C.send()}function POST(A,E,G,D){var C=getXMLHttpRequest();C.onreadystatechange=function(){if(C.readyState===4){G(C.responseText,C)}};D=(D===undefined)?true:D;try{C.onerror=function(H){logError("Error while sending POST:"+H)}}catch(B){}var F=fakeParam(A);C.open("POST",F,D);C.setRequestHeader("Content-type","application/x-www-form-urlencoded");C.send(E)}function fakeParam(A){if(A&&A.lastIndexOf("?")!==-1){return A+"&fparam="+(new Date().getTime())*Math.random()}else{return A+"?fparam="+(new Date().getTime())*Math.random()}}function theProgressBar(E,D){var F=false;var A=document.getElementById("progress-bar-template").innerHTML;if(F){return false}theProgressBar.title=E;F=true;var C=document.createElement("div");C.className="progress-bar";C.innerHTML=A;document.body.appendChild(C);C.bar=C.children[0].children[0];C.titleNode=C.bar.children[0];C.titleNode.innerHTML=theProgressBar.title;C.progress=C.bar.children[1];var B=function(){var G=D();if(G>=100){C.titleNode.innerHTML=theProgressBar.title+" 100% Done.";C.progress.style.width="100%";setTimeout(function(){F=false;document.body.removeChild(C)},200)}else{C.titleNode.innerHTML=theProgressBar.title+" "+Math.floor(G)+"%";C.progress.style.width=Math.floor(G)+"%";setTimeout(B,20)}};B();return true}function qconsole(){this.init=function(){if(this.initialized){return}this.initialized=true;var A=document.getElementById("console-template").innerHTML;this.container=document.createElement("div");this.container.className="qconsole";this.container.innerHTML=A;this.msgContainer=this.container.children[1];document.body.appendChild(this.container);this.msgContainer.scrollTop=this.msgContainer.scrollHeight;var B=this;this.container.ondblclick=function(){info("[double click] Clearing & hiding console...");B.clear();B.hide()}};this.log=function(C){var B=document.getElementById("console-msg-template").innerHTML;var A=document.createElement("div");A.className="msg";A.innerHTML=B;A.msg=A.children[1];A.header=A.children[0];A.msg.innerHTML=" >>> "+C;this.msgContainer.appendChild(A);this.msgContainer.scrollTop=this.msgContainer.scrollHeight};this.clear=function(){this.msgContainer.innerHTML=""};this.show=function(){qubit.opentag.Utils.addClass(this.container,"shown");qubit.opentag.Utils.removeClass(this.container,"hidden");this.hidden=false};this.hide=function(){qubit.opentag.Utils.removeClass(this.container,"shown");qubit.opentag.Utils.addClass(this.container,"hidden");this.hidden=true};this.init()}var Utils=qubit.opentag.Utils;function runTagHandler(A){var D=getParametersAndConfigForTagNode(A);if(D==="red"){logError("Please fill all highlighed parameter values.\n They are required for tag to run.",2000);return}var C=A.reference;var B=APP_PATH+"getClassPath?classPath=libraries."+C.PACKAGE_NAME+".local&file=UVConf.js";GET(B,function(G,H){var E=true;if(H.status!==200){E=false;log("UVConfig not found. Proceeding normally.")}try{if(E){log("Evaluating UVConf.js from "+B);qubit.opentag.Utils.geval(G)}}catch(F){error("Exception while running UVConf.js: "+F)}finally{runTag(A,D)}})}function runTag(O,A){try{var B={};var K=O.classReference;var J=O.reference;applyParametersAndConfigToTag(B,A);try{var E=B.parameters;for(var H=0;H<E.length;H++){var C=E[H];for(var G=0;G<J.config.parameters.length;G++){var I=J.config.parameters[G];if(I.token===C.token){C.uv=I.uv;break}}}}catch(L){}var D=J.preNode.value;if(String(D)!==J.config.pre&&String(D)!==String(J.pre)){B.pre=extractFunctionOrString(D)}var M=J.postNode.value;if(String(M)!==J.config.post&&String(M)!==String(J.post)){B.post=extractFunctionOrString(M)}var F=J.scriptNode.value;if(String(F)!==J.config.script&&String(F)!==String(J.script)){B.script=extractFunctionOrString(F)}var N=new K(B);info("triggering run() for "+N.config.name+" ...");N.run();var P="Currently executed tag instance is exposed as <pre>window.instance<pre>";info(P+"Please open web console to see more logs.<br/>To view library the logs run:<pre>instance.log.rePrint(5);</pre>in web console.",5000);window.instance=N}catch(L){logError("Error while executing configuration:"+L)}}function saveConfig(F){F=getLibraryReferenceNode(F);var E=F.reference;var B=getParametersAndConfigForTagNode(F,true,true);for(var D=0;D<B.parameters.length;D++){B.parameters[D].variable=undefined;delete B.parameters[D].variable}var A=json.serialize({parameters:B.parameters},{prettyPrint:true});var H=E.PACKAGE_NAME+".local";var G="qubit.opentag.Utils.namespace('"+H+"');\n";var I=encodeURIComponent("//:include tagsdk-current.js\n"+G+H+".Config = "+A+";");var C="classPath=libraries."+E.PACKAGE_NAME+".local&config="+I;POST(APP_PATH+"saveConfig",C,function(L,K){var J=qubit.opentag.Utils.gevalAndReturn(L);if(!J||!J.result.ok){logError(L)}else{info("Saved")}})}function saveNewVersion(E,F){var A=F||window.event;A.ignoreEvent=true;E=getLibraryReferenceNode(E);var D=E.reference;var B=prompt("Please enter the name of the new version, eg 'v1'.\n\n");if(!B){return}B=classPath(B);var H=true;if(!H){return}var G=D.PACKAGE_NAME.split(".");var I=G[0]+"."+G[1];var C="location=libraries&classPath="+D.PACKAGE_NAME+"&version="+I+"."+B;POST(APP_PATH+"saveNewVersion",C,function(L,K){var J=qubit.opentag.Utils.gevalAndReturn(L);if(!J||!J.result.ok){logError("Error while creating new version: "+L)}else{info("Created new version.");info("Rebuilding system...",10000);rebuildAndReload()}})}function rebuildAndReload(){if(window.buildLocationString){var A="path="+encodeURIComponent(window.buildLocationString);GET(APP_PATH+"rebuild?"+A,function(D,C){var B=qubit.opentag.Utils.gevalAndReturn(D);if(!B||!B.result.ok){logError("Rebuild failed! "+D)}else{info("System has been rebuilt for "+window.buildLocationString,10000);info("Reloading page.");location.reload()}})}}var editUVURL=LIBRARIES_REPO_LOC+"shared/templates/UVConf.js";function editUVURLHandler(A){GET(editUVURL,function(B,C){if(C.status!==200){logError(B)}else{editUV(A,B)}})}function editUV(A,B){var C=A.reference;openInEditorAndCreate("libraries."+C.PACKAGE_NAME+".local","UVConf.js",true,B)}function openInEditorHandler(A){var B=A.reference;openInEditorAndCreate("libraries."+B.PACKAGE_NAME,"Tag.js",false)}function openInEditorAndCreate(C,B,A,D){var D="classPath="+C+"&file="+B+"&create="+!!A+"&data="+encodeURIComponent(D);POST(APP_PATH+"openInEditor",D,function(G,F){var E=qubit.opentag.Utils.gevalAndReturn(G);if(!E||!E.result.ok){logError(G);logError("Make sure that CLASSPATH of your library matches its location!")}})}function reloadTagHandler(C){var F=qubit.opentag.Utils;var E=C.reference;var B=C.libraryWidget;var A=C.classReference.versionClassPath;var D=("classPath=libraries."+E.PACKAGE_NAME+"&file=Tag.js");reloadTests(C);POST(APP_PATH+"getClassPath",D,function(K,J){if(J.status!==200){logError("Error loading tag: "+K)}try{var G=getParametersAndConfigForTagNode(C,true,true);F.getObjectUsingPath(E.PACKAGE_NAME).Tag=undefined;qubit.opentag.Utils.geval(K);var I=F.getObjectUsingPath(E.PACKAGE_NAME+".Tag");I.versionClassPath=A;B.renderLibraryToNode(I,null,null,G)}catch(H){logError("Error loading tag: "+H)}})}function cancelEvent(A){if(A.stopPropagation){A.stopPropagation()}else{A.cancelBubble=true}}var Utils=qubit.opentag.Utils;var testSuiteCodeTemplateURL=LIBRARIES_REPO_LOC+"shared/templates/TestsSuite.js";function addEditTests(A){GET(testSuiteCodeTemplateURL,function(B,C){if(C.status!==200){logError(B)}else{addEditStandardTests(A,B)}})}function addEditStandardTests(C,B){C=getLibraryReferenceNode(C);if(C){var A=C.reference;var D=B.replace("_PACKAGE_",A.PACKAGE_NAME);D=D.replace("_TAG_",A.PACKAGE_NAME+".Tag");var E=A.PACKAGE_NAME.split(".").join("/");D=D.replace("_TAGPATH_",E+"/Tag.js");openInEditorAndCreate("libraries."+A.PACKAGE_NAME+".local","TestsSuite.js",true,D)}}var bddSuiteCodeTemplateURL=LIBRARIES_REPO_LOC+"shared/templates/BDDSuite.js";function addEditDescribeTests(A){GET(bddSuiteCodeTemplateURL,function(B,C){if(C.status!=200){logError(B)}else{addEditBDDTests(A,B)}})}function addEditBDDTests(C,B){C=getLibraryReferenceNode(C);if(C){var A=C.reference;var D=B.replace("_PACKAGE_",A.PACKAGE_NAME);D=D.replace("_TAG_",A.PACKAGE_NAME+".Tag");var E=A.PACKAGE_NAME.split(".").join("/");D=D.replace("_TAGPATH_",E+"/Tag.js");openInEditorAndCreate("libraries."+A.PACKAGE_NAME+".local","BDDSuite.js",true,D)}}function reloadTests(A){_reloadTest(A,"BDDSuite.js")}function _reloadTest(B,C){var F=qubit.opentag.Utils;var E=B.reference;var A=B.libraryWidget;var D=("classPath=libraries."+E.PACKAGE_NAME+".local&file="+C);POST(APP_PATH+"getClassPath",D,function(L,K){if(K.status!==200){log("Error loading test (probably no tests). "+L)}try{var G=getParametersAndConfigForTagNode(B,true,true);try{F.getObjectUsingPath(E.PACKAGE_NAME).local.TestsSuite=undefined}catch(I){}qubit.opentag.Utils.geval(L);var J=F.getObjectUsingPath(E.PACKAGE_NAME+".Tag");A.renderLibraryToNode(J,null,null,G)}catch(H){log("Error loading test: "+H)}finally{reloadBDDTests(B)}})}function reloadBDDTests(B){var E=qubit.opentag.Utils;var D=B.reference;var A=B.libraryWidget;var C=("classPath=libraries."+D.PACKAGE_NAME+".local&file=BDDSuite.js");POST(APP_PATH+"getClassPath",C,function(K,J){if(J.status!==200){log("Error loading test (probably no tests). "+K)}try{var F=getParametersAndConfigForTagNode(B,true,true);try{E.getObjectUsingPath(D.PACKAGE_NAME).local.BDDSuite=undefined}catch(H){}qubit.opentag.Utils.geval(K);var I=E.getObjectUsingPath(D.PACKAGE_NAME+".Tag");A.renderLibraryToNode(I,null,null,F)}catch(G){log("Error loading test: "+G)}})}var testsRunning=false;function runAllTests(H){if(testsRunning){info("Wait for currently running tests to finish.");return}testsRunning=true;var F=document.getElementsByTagName("div");var E=0;var C=0;var A=[];for(var B=0;B<F.length;B++){var D=F[B];if(D.getAttribute("library-node")==="true"){++E;A.push(D)}}var G=function(I){try{var J=A[I];if(!J){return}runTestsHandler(J,function(){++C;if(C<E){setTimeout(function(){G(C)},5)}if(C===E){testsRunning=false;if(H){H()}}})}catch(K){}};G(0);theProgressBar("Running test suites...",function(){if(C===0){return 0}return 100*(C/(E))})}function runTestsHandler(A,H){try{var G=A.reference;var F=qubit.opentag.Utils;var D=F.getObjectUsingPath(G.PACKAGE_NAME+".local.TestsSuite");var C=F.getObjectUsingPath(G.PACKAGE_NAME+".local.BDDSuite");var E=function(){var K=false;if(D&&!D.isFinished()){K=true}else{if(C&&!C.isFinished){K=true}}if(!K){var J=false;if(C){var M=C.children;for(var L=0;L<M.length;L++){if(M[L].result.status==="failed"){J=true;break}}}var I=false;if(D&&D.failedTests&&D.failedTests.length>0){I=true}if(C||D){if(I||J){F.addClass(A,"tests-failed")}else{F.addClass(A,"tests-passed")}}if(H){H()}}};if(D||C){if(D){runSuite(D,E)}if(C){runBDDSuite(C,E)}}else{if(H){H()}F.addClass(A,"tests-notests");log("No tests detected for "+G.config.name)}}catch(B){logError("Error while executing tests suite:"+B)}}function runSuite(A,B){if(A){A.onFinished=function(){if(B){B()}};A.run()}else{if(B){B()}}}function runBDDSuite(A,C){if(A){var B=A.resultCallback;A.resultCallback=function(){B.apply(A,arguments);A.isFinished=true;if(C){try{C()}catch(D){alert(D)}}};A.execute()}else{if(C){A.isFinished=true;C()}}}var Utils=qubit.opentag.Utils;function toggleUVSelector(A){if(A.innerHTML==="Close UV Browser"){var B=document.getElementById("uv-selector-holder");B.innerHTML="";A.innerHTML="Browse UV"}else{openUVVariableSelector();A.innerHTML="Close UV Browser"}}function openUVVariableSelector(){var A=document.getElementById("uv-selector-holder");A.innerHTML="";renderUVSelector(A)}var uvPopupTemplate=document.getElementById("uv-popup-template").innerHTML;function renderUVSelector(A,F){var B=qubit.opentag.Utils;A.innerHTML="";var C=document.createElement("div");C.innerHTML=uvPopupTemplate;A.appendChild(C);var D=C.children[0].children[1].children[0].children[0];var E=C.children[0].children[2];loadUVVariables(function(){var G=window.UVS;for(var H=0;H<G.length;H++){var I=G[H];var J=renderUVSelectorItemYoNode(D,I);(function(K){K.onclick=function(){E.value=K.expr;E.className="result";if(F){F(K.expr)}}}(J))}})}var uvPopupItemTemplate=document.getElementById("uv-popup-item-template").innerHTML;function renderUVSelectorItemYoNode(C,A){var D=qubit.opentag.Utils;var F=document.createElement("div");F.innerHTML=uvPopupItemTemplate;var E=F.children[0].children[0];var B=F.children[0].children[1];E.innerHTML=A.name;B.innerHTML=A.description;F.expr=A.expression;C.appendChild(F);return F}function loadUVVariables(A){if(window.UVS){if(A){A(UVS)}return}GET(LIBRARIES_REPO_LOC+"shared/bin/html/data/uv.data",function(D,I){if(I.status!==200){alert("Error loading UV data: "+D)}try{var J=D.split("\n");var F=[];var B={};for(var G=0;G<J.length;G++){var E=J[G].split("\t");var C={name:E[1],expression:E[2],description:E[3]};B[C.expression]=C;F.push(C)}window.UVS=F;window.EUVS=B;A(F)}catch(H){logError("Error loading UVs: "+H)}})}(function(){var json={};function checkIfInstanceOf(object,instances){for(var i=0;i<instances.length;i++){if((typeof(instances[i])==="function")&&object instanceof instances[i]){return true}}return false}json.checkIfInstanceOf=checkIfInstanceOf;function checkIfTypeOf(object,types){for(var i=0;i<types.length;i++){if(typeof(object)===types[i]){return true}}return false}function checkIfNameOf(string,names){for(var i=0;i<names.length;i++){if(string===names[i]){return true}}return false}function objectExistsInParentElements(object,parentElements){if(object instanceof Object){for(var i=0;i<parentElements.length;i++){if(parentElements[i]===object){return true}}}return false}function removeFromArray(object,array){for(var i=0;i<array.length;i++){if(array[i]===object){array.splice(i,1)}}return array}function jsonString(object){return'"'+object.replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"'}var TAB="  ";var _serialize=function(object,config,parentElements,level,levelMax){if(!isNaN(levelMax)&&level>=levelMax){return undefined}var excludedInstances,excludedTypes,excludedNames,own,includeFunctions=false,excludeOnTrue,dateAsString=true,raw=false,fakeFunctions=false,realFunctions=false,prettyPrint=false;if(config){if(config.prettyPrint){prettyPrint=true}if(config.raw){raw=config.raw}if(config.excludedInstances){excludedInstances=config.excludedInstances}if(config.excludedTypes){excludedTypes=config.excludedTypes}if(config.excludedNames){excludedNames=config.excludedNames}if(config.own){own=config.hasOwn}if(config.fakeFunctions){fakeFunctions=config.fakeFunctions}if(config.realFunctions){realFunctions=config.realFunctions}if(config.includeFunctions){includeFunctions=config.includeFunctions}if(config.excludeOnTrue){excludeOnTrue=config.excludeOnTrue}if(config.dateAsString){dateAsString=config.dateAsString}}var indent="";var eol="";if(prettyPrint){for(var i=0;i<level;i++){indent+=TAB}eol="\n"}if(object instanceof Date){return(!raw||dateAsString)?jsonString(object.toISOString()):object.valueOf()}else{if(!includeFunctions&&typeof object==="function"){return undefined}else{if(typeof object==="number"){return drawValue(indent,String(object))}else{if(typeof object==="string"){return drawValue(indent,jsonString(object))}else{if(object===null){return drawValue(indent,"null")}else{if(object===undefined){return raw?drawValue(indent,"undefined"):undefined}else{if(typeof prop==="boolean"){return drawValue(indent,String(object))}}}}}}}if(includeFunctions&&typeof object==="function"){if(fakeFunctions){return"(function(){})"}}if(includeFunctions&&typeof object==="function"){if(realFunctions){var out=prettyPrint?object.toString():object.toString();return drawValue(indent,out)}}if(objectExistsInParentElements(object,parentElements)){return undefined}parentElements.push(object);++level;if(object instanceof Array){var strings=[];for(var i=0;i<object.length;i++){if(excludeOnTrue){try{if(excludeOnTrue(object)){continue}}catch(ex){}}if(excludedInstances&&checkIfInstanceOf(object,excludedInstances)){continue}if(excludedTypes&&checkIfTypeOf(object,excludedTypes)){continue}try{var el=_serialize(object[i],config,parentElements,level,levelMax)}catch(ex){removeFromArray(object,parentElements);return jsonString(String(ex))}if(el!==undefined){strings.push(el)}}removeFromArray(object,parentElements);return drawObject("[","]",indent,eol,strings)}var parts=[];for(var key in object){var prop=object[key];if(own&&!object.hasOwnProperty(key)){continue}if(excludeOnTrue){try{if(excludeOnTrue(object)){continue}}catch(ex){}}if(excludedInstances&&checkIfInstanceOf(prop,excludedInstances)){continue}if(excludedTypes&&checkIfTypeOf(prop,excludedTypes)){continue}if(excludedNames&&checkIfNameOf(key,excludedNames)){continue}try{var objEl=_serialize(prop,config,parentElements,level,levelMax);if(objEl!==undefined){var elString=('"'+key.replace(/\"/g,'\\"')+'":')+objEl;parts.push(elString)}}catch(ex){removeFromArray(object,parentElements);return jsonString(String(ex))}}removeFromArray(object,parentElements);return drawObject("{","}",indent,eol,parts)};function drawValue(indent,string){return indent?(" "+string):string}function drawObject(s,e,indent,eol,parts){var array,spaceAfterColon=" ";if(indent===""){spaceAfterColon=""}if(indent||eol){if(parts.length===0){array=[spaceAfterColon,s,parts.join(","),e]}else{array=[spaceAfterColon,s,"\n",indent,TAB,parts.join(",\n"+indent+TAB),"\n",indent,e]}}else{array=[s,parts.join(","),e]}return array.join("")}json.serialize=function(object,config){var parentElements=[];var level;if(config){level=config.level}return _serialize(object,config,parentElements,0,level)};var global=(0,eval("this"))||(function(){return this}())||this.window;json.parse=function(string){if(!(/[^,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]/.test(string.replace(/"(\\.|[^"\\])*"/g,"")))){var expression="json.___tmp = ("+string+")";if(global.execScript){global.execScript(expression)}else{(function(){return global["eval"].call(global,expression)}())}}else{throw"insecure json!"}return json.___tmp};global.json=json;try{module.exports=json}catch(e){}}());(function(){function A(B){if(B){this.parentContainer=B.parentContainer;this.container=B.container;this.className=B.className;this.maxTime=B.maxTime;this.closeable=B.closeable;this.init()}}A.prototype.init=function(){this.container=this.container||document.createElement("div");this.container.className+=" qubit-notification "+(this.className?this.className:"")};A.prototype.drawCloseButton=function(){var B=this;if(this.closeable){this.closeButton=document.createElement("div");if(this.container.childNodes.length===0){this.container.appendChild(this.closeButton)}else{this.container.insertBefore(this.closeButton,this.container.childNodes[0])}this.closeButton.className="notification-close-button";this.closeButton.onclick=function(){B.destroy()}}};A.prototype.show=function(){this.container.style.display=""};A.prototype.hide=function(){this.container.style.display="none"};A.prototype.setContent=function(B){if(this.content!==B){this.content=B;this.container.innerHTML="";if(typeof(B)==="object"){this.container.appendChild(B)}else{this.container.innerHTML=B}this.drawCloseButton()}return B};A.prototype.paint=function(){if(!this.painted){this.parentContainer.appendChild(this.container);this.painted=true}};A.prototype.destroy=function(){try{if(this.onDestroy){this.onDestroy()}}finally{if(this.container.parentNode){this.container.parentNode.removeChild(this.container)}}};window.Notification=A}());(function(){var B=window.Notification;function A(C){if(C){this.maxTime=+C.maxTime||60*1000;this.notifiers={};this.className=C.className;this.parentContainer=C.parentContainer||document.body;this.container=C.container||document.createElement("div");this.init()}}A.prototype.notify=function(G,H,D,C,F){if(!this.notifiers[G]){var E=new B({parentContainer:this.container,maxTime:D,className:C,closeable:F}),I=this;E.onDestroy=function(){delete I.notifiers[G]};this.notifiers[G]=E;E.paint()}this.notifiers[G].show();this.notifiers[G].setContent(H);this.notifiers[G].timestamp=new Date().valueOf()};A.prototype.done=function(D,E,C){this.notify(D,E);var F=this;setTimeout(function(){if(F.notifiers[D]){F.notifiers[D].destroy();delete F.notifiers[D]}},C)};A.prototype.init=function(){this.setParentContainer(this.parentContainer);var D=this,C;C=function(){if(D.container&&D.container.parentNode){D.oldNotifiersCheck();setTimeout(C,500)}};C()};A.prototype.setParentContainer=function(C){this.parentContainer=C;this.parentContainer.appendChild(this.container);if(this.container.className.lastIndexOf(" qubit-notificationmanager"===-1)){this.container.className+=" qubit-notificationmanager "+this.className}};A.prototype.oldNotifiersCheck=function(){var D,C;for(D in this.notifiers){if(this.notifiers.hasOwnProperty(D)){C=this.notifiers[D].maxTime||this.maxTime;if((new Date().valueOf()-this.notifiers[D].timestamp)>C){this.notifiers[D].destroy()}}}};A.prototype.clear=function(){var C;for(C in this.notifiers){if(this.notifiers.hasOwnProperty(C)){this.notifiers[C].destroy()}}};window.NotificationManager=A}());var Utils=qubit.opentag.Utils;var parameterTemplate=document.getElementById("parameter-template").innerHTML;var parametersTemplate=document.getElementById("parameters-template").innerHTML;function Parameters(A){if(A){this.config=A;this.init()}}Utils.clazz("ui.Parameters",Parameters);Parameters.prototype.paint=function(){this.painted=true;this.config.parentContainer.appendChild(this.container)};Parameters.prototype.init=function(){var G=document.createElement("div");G.innerHTML=parametersTemplate;G.className="parameters-container";this.container=G;var D=G.children[1].children[0];var B=G.children[1].children[1];var A=this.config.params;for(var C=0;C<A.length;C++){G=document.createElement("div");var I=A[C];G.innerHTML=parameterTemplate;var H=G.getElementsByTagName("input")[0];H.pindex=C;G.paramNode=H;G.uvNode=G.getElementsByTagName("input")[1];G.getElementsByTagName("label")[0].innerHTML=I.name+" (token: <pre style='display:inline'>"+I.token+"</pre>)";var E=false;if(I.uv){E=true;G.uvNode.value=I.uv}else{Utils.addClass(G.uvNode,"no-uv");G.uvNode.value="edit script to set universal variable"}var F=(I.inputVariable!==undefined)?I.inputVariable:"";H.value=F;H.className=(F||E)?"":"red";if(E){H.setAttribute("onfocus",null);H.setAttribute("onblur",null)}(function(J){})(G);D.appendChild(G)}if(A.length===0){B.style.display="none";D.innerHTML="<div class='no-params'>No parameters defined.</div>"}else{B.style.display=""}};var excluded=["parameters","PACKAGE","dependencies","CONSTRUCTOR","dedupe","priv","name","description","inactive","vendor","loadDependenciesOnLoad","variables"];function propertyExcludedFromConfig(B){for(var A=0;A<excluded.length;A++){if(B===excluded[A]){return true}}return false}var hidden=["filterTimeout","isPrivate",,"usesDocumentWrite","timeout","singleton","locationPlaceHolder","locationDetail","locationObject","noMultipleLoad","__proto__"];function propertyHiddenFromConfig(B){for(var A=0;A<hidden.length;A++){if(B===hidden[A]){return true}}return false}function prepareConfigElement(E,B,A){var D=document.createElement("div");var C=B;D.innerHTML=A;D.children[0].className="config";D.getElementsByTagName("input")[0].cname=E;D.getElementsByTagName("label")[0].innerHTML=E;if(C!==undefined){D.getElementsByTagName("input")[0].value=C}D.getElementsByTagName("input")[0].entered=true;return D}var configTemplate=document.getElementById("config-template").innerHTML;var hiddenConfigTemplate=document.getElementById("toggled-config-template").innerHTML;function addConfig(C,B){var E=document.createElement("div");E.innerHTML=hiddenConfigTemplate;E.className="config-header";var A=E.children[0].children[0];A.innerHTML="<span plus='true'>+</span> Configuration";toggleShowSibling(A);var D=E.children[0].children[1];C.appendChild(E);for(var H in B){if(!propertyExcludedFromConfig(H)&&!propertyHiddenFromConfig(H)){var G=prepareConfigElement(H,B[H],configTemplate);D.appendChild(G)}}var F=document.createElement("div");F.innerHTML=hiddenConfigTemplate;F.className="config-header";D.appendChild(F);var A=F.children[0].children[0];D=F.children[0].children[1];toggleShowSibling(A);A.innerHTML="<span plus='true'>+</span> Advanced";for(var H in B){if(!propertyExcludedFromConfig(H)&&propertyHiddenFromConfig(H)){var G=prepareConfigElement(H,B[H],configTemplate);D.appendChild(G)}}}var prePostTemplate=document.getElementById("pre-post-script-template").innerHTML;function addPrePostTemplate(C,J){var D=document.createElement("div");D.innerHTML=prePostTemplate;var E=D.getElementsByTagName("textarea");var B=E[0];var H=E[1];var F=E[2];var G=J.config.pre?J.config.pre:String(J.pre);var A=J.config.post?J.config.post:String(J.post);var I=J.config.script?J.config.script:String(J.script);B.value=String(G);H.value=String(A);F.value=String(I);B.style.display="none";H.style.display="none";F.style.display="none";J.preNode=B;J.postNode=H;J.scriptNode=F;C.appendChild(D)}var testTemplate=document.getElementById("unit-test-template").innerHTML;function addTest(A,B){var C=document.createElement("div");C.innerHTML=testTemplate;C.className="unit-test";B.testNode=C;B.statusNode=C.children[0];B.nameNode=C.children[1];B.nameNode.innerHTML=B.name;B.onFinished=function(){if(this.failed){Utils.addClass(this.statusNode,"failed")}else{if(this.passed){Utils.addClass(this.statusNode,"passed")}}};A.appendChild(C)}function addBDDTest(A,D){var B=document.createElement("div");B.innerHTML=testTemplate;B.className="unit-test";D.testNode=B;D.statusNode=B.children[0];D.nameNode=B.children[1];D.nameNode.innerHTML=D.description;var C=D.resultCallback;D.resultCallback=function(E){C.apply(D,arguments);if(D.result.status==="failed"){Utils.addClass(D.statusNode,"failed")}else{if(D.result.status==="passed"){Utils.addClass(D.statusNode,"passed")}}};A.appendChild(B)}var testsSuiteTemplate=document.getElementById("unit-tests-suite-template").innerHTML;function addTestsSuite(A,F){var E=document.createElement("div");E.className="unit-tests-suite";E.innerHTML=testsSuiteTemplate;var C=Utils.getObjectUsingPath(F.PACKAGE_NAME+".local.TestsSuite");var B=Utils.getObjectUsingPath(F.PACKAGE_NAME+".local.BDDSuite");A.appendChild(E);var D=E.children[1];renderTestsToNode(D,C,B)}function renderTestsToNode(E,D,C){E.innerHTML="";if(C){C.unitTestsNode=E;var B=C.children;for(var A=0;A<B.length;A++){addBDDTest(E,B[A])}}if(D){D.unitTestsNode=E;var B=D.tests;for(var A=0;A<B.length;A++){addTest(E,B[A])}}}function prepareVendorNode(B){var A=document.createElement("div");A.innerHTML="<a class='plain' href='#-2'>"+B+"</a>";A.className="vendor";A.children[0].onclick=function(){var C=!this.ishidden?"hide":"show";this.ishidden=!this.ishidden;this.parentNode.className="vendor "+C};return A}function findTags(A,B){B=B||[];Utils.traverse(A,function(D,C,F,E){if(D&&D.prototype&&F!=="superclass"&&D.prototype instanceof qubit.opentag.BaseTag&&D!==qubit.opentag.BaseTag&&D!==qubit.opentag.LibraryTag&&D!==qubit.opentag.CustomTag&&A.Tag!==D){B.push(D)}},{objectsOnly:true,track:true});return B}(function(){var C=document.getElementById("library-template").innerHTML;var B=qubit.opentag.Utils;function D(E){this.config=E||{};if(E){this.libraryNode=document.createElement("div");this.config.parentContainer.appendChild(this.libraryNode);this.init(this.paint.bind(this))}}B.clazz("ui.Library",D);D.prototype.paint=function(E){E=E||"hide";this.painted=true;this.renderLibraryToNode(this.config.libraryClass,this.libraryNode,E)};D.prototype.init=function(G){var E=APP_PATH+"getClassPath?classPath=libraries."+this.config.libraryClass.prototype.PACKAGE_NAME+".local&file=Config.js";try{GET(E,function(I){try{B.geval(I)}catch(H){}if(G){G()}})}catch(F){if(G,F){G()}}};D.prototype.renderLibraryToNode=function(S,F,G,J){J=J||{};var Q=new S();Q.unregister();if(J.parameters&&Q.config.parameters){for(var N=0;N<J.parameters.length;N++){var K=J.parameters[N].token;for(var M=0;M<Q.config.parameters.length;M++){if(Q.config.parameters[M].token===K){Q.config.parameters[M].inputVariable=J.parameters[N].inputVariable}}}}var V=Q.PACKAGE_NAME+"."+Q.CLASS_NAME;if(!F){F=document.getElementById(V);B.removeClass(F,"tests-failed");B.removeClass(F,"tests-passed");B.removeClass(F,"tests-notests")}F.setAttribute("library-node","true");F.innerHTML=C;var L="<a href='#-3' onclick='saveNewVersion(this, arguments[0]);'> clone </a>";var H="";if(S.versionClassPath){var U=S.prototype.PACKAGE_NAME.replace(S.versionClassPath+".","");U=U.replace(/\._(\d)/g,".$1");H="<span class='version-title'> ("+U+") </span>"}F.children[0].children[1].innerHTML=Q.config.name+H+L;B.addClass(F,"library");if(G){B.addClass(F,G)}F.reference=Q;F.libraryWidget=this;F.classReference=S;F.id=V;var T=Q.config.parameters;var I=F.children[7].children[0];var O=F.children[7].children[1];try{var E=B.getObjectUsingPath(Q.PACKAGE_NAME+".local.Config");if(E&&E.parameters){A(T,E.parameters)}}catch(P){}I.children[0].innerHTML=(Q.config.imageUrl?"<img class='logo' src='"+Q.config.imageUrl+"' align='right' />":"")+Q.config.description;var R=new ui.Parameters({parentContainer:O,params:T});R.paint();addConfig(O,Q.config);addPrePostTemplate(O,Q);addTestsSuite(O,Q)};function A(L,K){for(var H=0;H<L.length;H++){var G=L[H];for(var F=0;F<K.length;F++){if(G.token&&G.token===K[F].token){var J=L[H].inputVariable;var E=L[H].uv;var I=K[H].uv;L[H]=K[F];if(J){L[H].inputVariable=J}if(E){L[H].uv=E}break}}}}})();var Utils=qubit.opentag.Utils;window.LIBRARIES={};function renderAllLibrariesToPage(){var Q=document.getElementById("libraries");Q.innerHTML="";var H=[];var P=qubit.opentag.libraries;for(var N in P){var O=P[N];var F=prepareVendorNode(N);for(var L in O){try{var E=O[L].Tag;var G=[N,L].join(".");if(E){var A=new E({});G=E.prototype.PACKAGE_NAME;A.unregister();if((A) instanceof qubit.opentag.LibraryTag){(function(T,S,R){H.push([T,S,R])}(F,E,A))}}var B=findTags(O[L]);for(var D=0;D<B.length;D++){var K=new B[D]({});K.unregister();B[D].versionClassPath=G;(function(T,S,R){H.push([T,S,R])}(F,B[D],K))}}catch(J){if(window.console&&console.log){console.log("Failed to load tag configuration, possible syntax error:"+J);info("Failed to load tag configuration, possible syntax error:"+J)}else{logError("Failed to load tag configuration, possible syntax error:"+J)}}}H.sort(function(Y,X){var Z=Y[1];var R=X[1];var T=Y[2].config;var S=X[2].config;var W=T.name===S.name;if(W){var V="";var U="";if(Z.versionClassPath){V=Z.prototype.PACKAGE_NAME.replace(Z.versionClassPath+".","")}if(R.versionClassPath){U=R.prototype.PACKAGE_NAME.replace(R.versionClassPath+".","")}return compareVersions(V,U)}else{if(T.name>S.name){return 1}else{if(T.name===S.name){return 0}else{return -1}}}});C+=H.length;Q.appendChild(F)}var C=H.length;var I=0;theProgressBar("Rendering...",function(){return 100*(I/C)});var M=false;(function(S){var R=0;var T=function(){for(var V=0;V<8;V++){I++;if(R===S.length){if(!M){setTimeout(bodyLoaded,200)}M=true;return}var W=S[R][0];var X=S[R][1];var U=new ui.Library({parentContainer:W,libraryClass:X});LIBRARIES[X.PACKAGE_NAME+"."+X.CLASS_NAME]=U;R++}setTimeout(T,4)};T()}(H))}var total=1;var counted=0;function loadAllLibs(A){var B=LIBRARIES_REPO_LOC+"shared/bin/html/scripts.txt";GET(B,function(H){var D=[];var G=H.split(",");G.push("shared/bin/html/js/build-location.js");total=1;counted=0;if(!A){A=[];for(var F=0;F<G.length;F++){if(G[F]&&G[F].indexOf("shared/js/tagsdk-current.js")==-1){A.push(G[F])}}}theProgressBar("Loading scipts",function(){if(counted===0){return 0}return 100*(counted/(A.length+total))});var E=0;var C=function(){if(E===A.length){return}var J=E;E++;var I=LIBRARIES_REPO_LOC+A[J];setTimeout(function(){_loadSingle(I,J,C,A,D)},0)};C()})}function compareVersions(F,D){var Q=F.replace(/\./g,".");var H=Q.split(".");var P=D.replace(/\./g,".");var E=P.split(".");var J=null;if(H.length&&E.length){var I=H[0].replace(/[^\d+]/g,".").split(".");I=I[I.length-1];var G=E[0].replace(/[^\d+]/g,".").split(".");G=G[G.length-1];var M=H[0].substring(0,H[0].lastIndexOf(I));var L=E[0].substring(0,E[0].lastIndexOf(G));if(M===L&&(!isNaN(+I)&&!isNaN(+G))){if(+I<+G){J=true}else{if(+I>+G){J=false}}}else{if(H[0]>E[0]){J=true}else{if(H[0]<E[0]){J=false}}}}if(J===null){for(var K=1;K<H.length&&K<E.length;K++){var N=E[K];var O=H[K];var C=O.charAt(0)==="0"||N.charAt(0)==="0";if(C&&K!==0){O="0."+O;N="0."+N}if(!isNaN(+O)&&!isNaN(+N)){if(+(O)<+(N)){J=true;break}else{if(+(O)>+(N)){J=false;break}}}else{if(O<N){J=true;break}else{if(O>N){J=false;break}}}}}if(H.length!==E.length&&J===null){J=(H.length<E.length)}if(J===true){return 1}else{if(J===null){return 0}else{return -1}}}function _loadSingle(D,C,E,B,A){GET(D,function(G,F){try{A[C]={expr:G,url:D};log(D);counted++;if(B.length===counted){_allScriptsFetched(A)}}finally{if(E){E()}}})}function _allScriptsFetched(scripts){for(var x=0;x<scripts.length;x++){try{eval(scripts[x].expr)}catch(ex){logError("Failed to load: "+scripts[x].url+"\nException: "+ex)}}theProgressBar.title+=", rendering... ";listScripts(scripts);setTimeout(function(){counted++;renderAllLibrariesToPage();window.toggleConsole();qubit.opentag.Log.LEVEL=3;qubit.opentag.Log.COLLECT_LEVEL=5},50)}function keepRunningTests(){if(location.href.indexOf("runTests=true")!==-1){info("Running tests...");runAllTests(function(){countdown("Automatically running tests... ",10);setTimeout(keepRunningTests,10*1000)})}}function countdown(D,C,A){if(C<=0){return}A=A||"";info(D+C+A,1000,"countdown");var B=C-1;setTimeout(function(){countdown(D,B)},1000)}function listScripts(A){return;var C="<div>";for(var B=0;B<A.length;B++){var D=A[B].url;if(D){C+="<a href='"+D+"' target='frame"+B+"' >"+D+"</a>"}}C+="</div>";document.getElementById("sources").innerHTML=C}function bodyLoaded(){setTimeout(keepRunningTests,1000)}window.Main=function(){window.qlog=new qconsole();window.toggleConsole=function(){qlog.hidden?qlog.show():qlog.hide()};window.logError=function(A,B){log("<span style='color: red'>"+A+"</span>");info("<span style='color: #FF766F'>"+A+"</span>",B||5000)};window.info=function(B,A,C){DefaultNotificationsMgr.notify(C||new Date().valueOf(),B,A||2800,"",true);log(B)};window.log=function(A){qlog.log(A)};Suite.log=Test.log=function(A){log(A)};loadAllLibs();window.DefaultNotificationsMgr=new NotificationManager({maxTime:4*1000})};